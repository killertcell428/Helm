# ネクストステップ（再整理版）

**最終更新**: 2025年1月31日  
**方針**: ローカル側で進められる重要ポイントに集中

---

## ✅ 完了したタスク

### デプロイ完了（2025年2月1日）

- ✅ Google Cloud Runへのバックエンドデプロイ完了
  - URL: https://helm-api-dsy6lzllhq-an.a.run.app
  - Gemini 3 Flash Previewが正常に動作
- ✅ Vercelへのフロントエンドデプロイ完了
  - URL: https://v0-helm-pdca-demo.vercel.app
- ✅ APIキー漏洩問題の解決（新しいAPIキーに更新）
- ✅ CORS設定完了
- ✅ 動作確認完了（マルチ視点LLM分析が正常に動作）

詳細は [デプロイ関連ドキュメント](../gcloud/) を参照してください。

---

## 🎯 優先度の高いタスク（順次開発）

### 1. PDCAサイクル継続機能の実装 ⭐ 最優先

**目的**: エージェントが作った成果物で次の会議が行われ次のPDCAに続くまでのストーリーを実際のツールで見れるようにする

**現状の問題**:
- 実行結果受領後、次のPDCAサイクルへの接続が不十分
- 「3週間後の経営会議での変化」がテキスト説明のみで、実際のデータとして見れない
- 次の会議データを再度取り込んで分析する流れが実装されていない

**実装内容**:

#### 1.1 次の会議データの取り込み機能
- [ ] 次の会議（3週間後）の議事録・チャットデータをモックで準備
- [ ] 前回の実行結果（生成された資料）を参照する機能
- [ ] 前回の介入がどう反映されたかを可視化

#### 1.2 PDCAサイクル継続の可視化
- [ ] 前回の分析結果と今回の分析結果を比較表示
- [ ] 構造スコアの改善推移をグラフ表示
- [ ] 前回の介入案が今回の会議でどう議論されたかを表示

#### 1.3 成果物の追跡機能
- [ ] 生成された資料（Google Docs）が実際に会議で使われたかを追跡
- [ ] 会議議事録から「3案比較資料」への言及を検出
- [ ] 前回の介入が効果的だったかを評価

**実装ファイル**:
- `Dev/app/v0-helm-demo/app/demo/case1/page.tsx` - フロントエンド
- `Dev/backend/main.py` - 次の会議データ取り込みAPI
- `Dev/backend/services/pdca_cycle.py` - PDCAサイクル管理サービス（新規）

**見積もり**: 3-5日

---

### 2. 評価設計・データ取り扱い・ガードレールの既存システムへの統合 ⭐ 高優先度

**目的**: 実装した機能を既存システムに統合し、実際に動作するようにする

**実装状況**:
- ✅ 評価指標の計算機能（`evaluation_metrics.py`）
- ✅ 段階的エスカレーション機能（`staged_escalation.py`）
- ✅ データマスキング機能（`data_masking.py`）
- ✅ 監査ログ機能（`audit_log.py`）
- ✅ 説明文の根拠引用機能（`evidence_citation.py`）
- ✅ 確信度に基づくエスカレーション（`confidence_based_escalation.py`）

**統合作業**:

#### 2.1 エスカレーションエンジンの更新
- [ ] `Dev/backend/services/escalation_engine.py` を更新
- [ ] 段階的エスカレーション機能を統合
- [ ] 確信度に基づくエスカレーションを統合

#### 2.2 分析結果の説明文生成の更新
- [ ] `Dev/backend/services/analyzer.py` を更新
- [ ] 根拠引用機能を統合

#### 2.3 データ取り込み時のマスキング
- [ ] `Dev/backend/main.py` の `/api/meetings/ingest` と `/api/chat/ingest` を更新
- [ ] データマスキング機能を統合

#### 2.4 監査ログの記録
- [ ] 各APIエンドポイントに監査ログの記録を追加

**実装ファイル**:
- `Dev/backend/services/escalation_engine.py` - エスカレーションエンジンの更新
- `Dev/backend/services/analyzer.py` - 分析結果の説明文生成の更新
- `Dev/backend/main.py` - APIエンドポイントの更新

**見積もり**: 2-3日

---

### 3. 評価システムとエスカレーションの説得力設計 ⭐ 中優先度

**目的**: なぜその評価・エスカレーション先が良いのかの根拠を明確化する設計を練る

**現状の問題**:
- 評価システム（0.6×ルールベース + 0.4×LLM）の根拠が弱い
- エスカレーション先の決定理由が「常にExecutive」で固定
- 「なぜその重みなのか」「なぜその閾値なのか」の説明がない

**実装内容**:

#### 2.1 評価システムの根拠設計
- [ ] 重み（0.6/0.4）の根拠を明確化
  - ルールベースの利点（見逃しゼロの安全網）
  - LLMの利点（文脈理解、柔軟性）
  - 両者の組み合わせによる相乗効果
- [ ] 閾値（70点）の決定根拠を明確化
  - 誤検知率と見逃し率のバランス
  - 実際のデータに基づく検証結果（可能な範囲で）
- [ ] マルチ視点評価の根拠を明確化
  - 各ロールの重み（Executive: 0.4, Planning: 0.3, Staff: 0.2, Governance: 0.1）の根拠
  - なぜ4つの視点が必要なのか

#### 2.2 エスカレーション先決定の根拠設計
- [ ] 責任モデルに基づくエスカレーション先決定ロジックの実装
  - パターンIDに基づく適切なロールの決定
  - 組織グラフ（将来実装）を参照した決定
- [ ] エスカレーション理由の詳細化
  - 「なぜこの人を呼び出すべきか」の具体的な説明
  - 責任モデルに基づく説明生成
- [ ] エスカレーション先の選択肢提示
  - 複数の候補を提示し、それぞれの理由を説明
  - ユーザーが選択できるUI（将来実装）

**実装ファイル**:
- `Dev/backend/services/escalation_engine.py` - エスカレーションエンジンの強化
- `Dev/backend/services/evaluation_rationale.py` - 評価根拠生成サービス（新規）
- `Dev/backend/services/responsibility_model.py` - 責任モデルサービス（新規）
- `Dev/app/v0-helm-demo/app/demo/case1/page.tsx` - 評価・エスカレーション根拠の表示

**見積もり**: 3-4日

---

### 4. デモページの記載を詰める ⭐ 高優先度

**目的**: 口頭やスライドで説明すべきところを削除し、Helmの機能内の入出力や機能だけがデモで出てくるように改修

**現状の問題**:
- デモページに説明文が多すぎる（口頭やスライドで説明すべき内容が記載されている）
- Helmの機能の入出力が不明確
- デモとして見せるべき「Helmが何をしているか」が埋もれている

**実装内容**:

#### 3.1 説明文の削減
- [ ] 各ステートの説明文を最小限に
  - 「よくある組織課題」などの説明を削除
  - 「Helm導入後の効果指標」などの説明を削除
  - 口頭やスライドで説明すべき内容は別ドキュメントに移動
- [ ] Helmの機能の入出力に集中
  - 入力: 議事録、チャットログ
  - 出力: 分析結果、エスカレーション、実行結果

#### 3.2 機能の可視化強化
- [ ] 各ステートで「Helmが何をしているか」を明確に表示
  - データ取り込み: 何のデータをどこから取得したか
  - 分析: どのような分析を実行したか
  - エスカレーション: なぜこの人を呼び出すのか
  - 実行: どのようなタスクを実行したか
- [ ] 入出力データの構造を明確に表示
  - JSON形式での表示（折りたたみ可能）
  - データの流れを可視化

#### 3.3 UIの簡素化
- [ ] 不要な装飾を削除
- [ ] 重要な情報（スコア、パターン、エスカレーション理由）を強調
- [ ] デモとして見せるべき情報だけを表示

**実装ファイル**:
- `Dev/app/v0-helm-demo/app/demo/case1/page.tsx` - Case1デモページ
- `Dev/app/v0-helm-demo/app/demo/case2/page.tsx` - Case2デモページ
- `Dev/app/v0-helm-demo/app/demo/case3/page.tsx` - Case3デモページ
- `Dev/docs/apppage/case1.md` - Case1仕様書（説明文の整理）

**見積もり**: 2-3日

---

### 5. ADKエージェントPhase2実装

**目的**: モック実装から実API統合への移行

**現状**:
- Phase1（モック実装）は完了
- Phase2（実API統合）は未実装

**実装内容**:
- [ ] Vertex AI Search API統合（ResearchAgent用）
- [ ] Google Drive API統合（AnalysisAgent用）
- [ ] Google Chat/Gmail API統合（NotificationAgent用）

**注意**: このタスクはGemini API接続問題が解決してから着手

**見積もり**: 3-5日

---

## 📋 実装順序

### Phase 1: 評価設計・データ取り扱い・ガードレールの統合（最優先）
1. **評価設計・データ取り扱い・ガードレールの既存システムへの統合** (2-3日)
   - エスカレーションエンジンの更新
   - 分析結果の説明文生成の更新
   - データ取り込み時のマスキング
   - 監査ログの記録

### Phase 2: デモページの改善
2. **デモページの記載を詰める** (2-3日)
   - 説明文の削減
   - 機能の可視化強化
   - UIの簡素化

### Phase 3: PDCAサイクル継続機能
3. **PDCAサイクル継続機能の実装** (3-5日)
   - 次の会議データの取り込み機能
   - PDCAサイクル継続の可視化
   - 成果物の追跡機能

### Phase 4: 評価・エスカレーションの説得力設計
4. **評価システムとエスカレーションの説得力設計** (3-4日)
   - 評価システムの根拠設計
   - エスカレーション先決定の根拠設計

### Phase 5: ADKエージェントPhase2（Gemini API接続問題解決後）
5. **ADKエージェントPhase2実装** (3-5日)
   - 実API統合

---

## 🔍 各タスクの詳細設計

### タスク1: PDCAサイクル継続機能の詳細設計

#### データフロー
```
[前回の実行結果]
  ↓
[次の会議データ取り込み]
  ↓
[前回の介入が反映されたか検証]
  ↓
[構造スコアの改善評価]
  ↓
[次のPDCAサイクル開始]
```

#### API設計
- `POST /api/meetings/ingest-next` - 次の会議データの取り込み
- `GET /api/pdca/cycle/{cycle_id}/comparison` - 前回との比較
- `GET /api/pdca/cycle/{cycle_id}/improvement` - 改善評価

#### フロントエンド設計
- `next_cycle` ステートの強化
- 前回の分析結果と今回の分析結果の比較表示
- 構造スコアの改善推移グラフ

### タスク2: 評価・エスカレーションの説得力設計の詳細設計

#### 評価システムの根拠
- 重み（0.6/0.4）の根拠:
  - ルールベース: 見逃しゼロの安全網、再現性が高い
  - LLM: 文脈理解、柔軟性、複雑なパターン検出
  - 組み合わせ: ルールベースの客観性とLLMの柔軟性を両立

#### エスカレーション先決定の根拠
- 責任モデルに基づく決定:
  - パターンID → 責任ロールのマッピング
  - 組織グラフ（将来実装）を参照
- エスカレーション理由の生成:
  - 責任モデルに基づく説明
  - 具体的な証拠に基づく説明

### タスク3: デモページの記載を詰める詳細設計

#### 削除すべき説明文
- 「よくある組織課題」
- 「Helm導入後の効果指標（フェルミ推定）」
- 「組織構造が継続的に改善」
- 「Helmが実現したこと」

#### 残すべき情報
- Helmの機能の入出力
- 各ステートでHelmが何をしているか
- データの構造（JSON形式）

#### 追加すべき情報
- データの流れの可視化
- 各ステップでのHelmの処理内容
- 入出力データの構造

---

## 📚 関連ドキュメント

- `Dev/docs/status/CURRENT_DEVELOPMENT_STATUS.md` - 現在の開発状況
- `Dev/docs/apppage/case1.md` - Case1仕様書
- `Dev/backend/services/escalation_engine.py` - エスカレーションエンジン
- `Dev/ARCHITECTURE.md` - アーキテクチャドキュメント

---

## ⚠️ 注意事項

1. **ADKエージェントPhase2は後回し**
   - Gemini API接続問題が解決してから着手
   - モック実装でもデモは動作する

2. **デモページの改善を最優先**
   - デモとして見せるべき情報を明確に
   - 説明文は別ドキュメントに移動

3. **評価・エスカレーションの説得力設計**
   - 根拠を明確にすることで、Helmの価値が伝わりやすくなる
   - 実装と並行して設計を練る

4. **PDCAサイクル継続機能**
   - Helmの核心機能の一つ
   - デモとして見せる価値が高い
