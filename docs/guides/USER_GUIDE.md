# Helm ユーザーガイド

このガイドは、Helmを使用するエンドユーザー向けのドキュメントです。

## 目次

1. [はじめに](#はじめに)
2. [クイックスタート](#クイックスタート)
3. [機能説明](#機能説明)
4. [デモケースの説明](#デモケースの説明)
5. [よくある質問（FAQ）](#よくある質問faq)
6. [トラブルシューティング](#トラブルシューティング)

---

## はじめに

### Helmとは何か

Helmは、**組織を賢くするAI**です。組織の意思決定プロセスを監視し、構造的問題を検知して改善を提案するシステムです。

**Helmの特徴:**
- **AIが人を呼び出す**: 構造的問題を検知すると、自動的に適切なロール（Executiveなど）を呼び出します
- **定量評価**: テキストから評価基準を自動抽出し、スコア（0-100点）に基づいて客観的に評価します
- **統合判断**: 複数情報源（会議議事録、チャット、資料）を統合的に評価し、組織全体を見た判断を提供します

### このガイドの使い方

このガイドでは、Helmの基本的な使い方から、よくある問題の解決方法まで説明します。

- **初めて使用する方**: [クイックスタート](#クイックスタート)から始めてください
- **機能を理解したい方**: [機能説明](#機能説明)を参照してください
- **問題が発生した方**: [トラブルシューティング](#トラブルシューティング)を参照してください

---

## クイックスタート

### 初めての起動方法

1. **バックエンドの起動**
   ```bash
   cd Dev/backend
   python -m venv venv
   venv\Scripts\activate  # Windows
   pip install -r requirements_minimal.txt
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

2. **フロントエンドの起動**
   ```bash
   cd Dev/app/v0-helm-demo
   pnpm install
   pnpm dev
   ```

3. **ブラウザでアクセス**
   - フロントエンド: http://localhost:3000
   - デモページ: http://localhost:3000/demo/case1

詳細は [クイックスタートガイド](./QUICKSTART.md) を参照してください。

### 基本的な使い方

1. **デモページにアクセス**
   - http://localhost:3000/demo/case1 を開く

2. **デモの実行**
   - 「Helmがある場合を見る」ボタンをクリック
   - 各ステップでボタンをクリックして進む
   - 構造的問題検知 → Executive呼び出し → AI自律実行の流れを確認

---

## 機能説明

### 議事録取り込み機能

**機能概要:**
Google Meet議事録を取り込み、パース処理を実行します。

**使用方法:**
1. 議事録データを準備（またはAPIから自動取得）
2. `/api/meetings/ingest` エンドポイントにリクエストを送信
3. パースされたデータ（発言者、KPI、撤退議論など）が返される

**取得される情報:**
- 発言者ごとの発言内容
- KPI言及の検出
- 撤退/ピボット議論の有無
- 判断集中率

### チャット取り込み機能

**機能概要:**
Google Chatログを取り込み、パース処理を実行します。

**使用方法:**
1. チャットメッセージを準備（またはAPIから自動取得）
2. `/api/chat/ingest` エンドポイントにリクエストを送信
3. パースされたデータ（リスク、エスカレーション、反対意見など）が返される

**取得される情報:**
- リスク提起メッセージ
- エスカレーション言及の有無
- 反対意見の検出
- 懸念の有無

### 構造的問題検知機能

**機能概要:**
会議データとチャットデータから構造的問題を検知します。

**検知されるパターン:**
- **B1_正当化フェーズ**: KPI悪化認識があるが戦略変更議論がない
- **ES1_報告遅延**: リスク提起メッセージが存在するがエスカレーション未完了

**使用方法:**
1. 議事録とチャットを取り込む
2. `/api/analyze` エンドポイントにリクエストを送信
3. 分析結果（スコア、重大度、説明など）が返される

**分析結果の見方:**
- **スコア**: 0-100点（70点以上でエスカレーション）
- **重大度**: HIGH / MEDIUM / LOW
- **説明**: 検知された問題の詳細説明

### Executive呼び出し機能

**機能概要:**
構造的問題が検出された場合、自動的にExecutiveを呼び出します。

**使用方法:**
1. 構造的問題検知が完了する
2. スコアが閾値（70点）を超えている場合、自動的にエスカレーション
3. `/api/escalate` エンドポイントでエスカレーションを作成

**エスカレーション情報:**
- 対象ロール（Executiveなど）
- エスカレーション理由
- 重大度・緊急度

### AI自律実行機能

**機能概要:**
Executive承認後、AIが自律的にタスクを実行します。

**実行されるタスク:**
- 市場データ分析
- 社内データ統合
- 3案比較資料の自動生成
- 関係部署への事前通知
- 会議アジェンダの更新

**使用方法:**
1. Executiveが介入案を承認
2. `/api/execute` エンドポイントで実行を開始
3. 実行進捗をリアルタイムで確認（WebSocket）
4. 実行結果を取得

**実行結果:**
- 生成された資料のダウンロードURL
- 通知送信結果
- 分析結果データ

---

## デモケースの説明

### Case1: 経営会議後の構造変化検知

**シナリオ:**
四半期経営会議でKPI悪化が共有されたが、戦略変更の議論が起きなかった場合。

**デモの流れ:**

1. **Before（人だけの場合）**
   - Helm導入前の状況を確認
   - 構造的問題が検知されない

2. **データ受領直後**
   - 議事録とチャットが取り込まれる
   - パース処理が実行される

3. **Helm解析完了**
   - 構造的問題「B1_正当化フェーズ」が検知される
   - スコア75点（閾値70点を超過）

4. **Executiveの判断**
   - Executiveが介入案を確認
   - 承認または修正を選択

5. **AI自律実行中**
   - タスクが順次実行される
   - 進捗がリアルタイムで更新される

6. **実行結果受領**
   - 生成された資料のダウンロードURL
   - 実行結果の詳細

**期待される効果:**
- 意思決定速度の改善（7-14日 → 2日以内）
- Zombie Project検知率の向上（0% → 90%以上）

### Case2, Case3（将来実装時）

Case2とCase3は将来実装予定です。

---

## よくある質問（FAQ）

### エラーが発生した場合

**Q: APIエラーが発生しました。どうすればよいですか？**

A: エラーレスポンスに含まれる `error_id` を記録しておいてください。トラブルシューティングに役立ちます。

**Q: エラーメッセージが表示されません。**

A: ブラウザの開発者ツール（F12）のConsoleタブでエラーログを確認してください。

### データが表示されない場合

**Q: 議事録が表示されません。**

A: 以下を確認してください：
1. バックエンドが起動しているか（http://localhost:8000/docs で確認）
2. フロントエンドの環境変数（`NEXT_PUBLIC_API_URL`）が正しく設定されているか
3. ブラウザの開発者ツールでAPIリクエストが成功しているか

**Q: 分析結果が表示されません。**

A: 以下を確認してください：
1. 議事録とチャットが正しく取り込まれているか
2. 分析リクエストが成功しているか（ブラウザの開発者ツールで確認）

### 実行が完了しない場合

**Q: AI自律実行が完了しません。**

A: 以下を確認してください：
1. バックエンドのログでエラーが発生していないか
2. WebSocket接続が確立されているか（ブラウザの開発者ツールで確認）
3. 実行状態を `/api/execution/{execution_id}` で確認

**Q: タスクが途中で止まります。**

A: バックエンドのログを確認してください。エラーが発生している場合は、エラーメッセージを確認してください。

### その他

**Q: モックデータと実データの違いは何ですか？**

A: 
- **モックデータ**: 開発・テスト用のサンプルデータ
- **実データ**: 実際のGoogle Meet議事録やGoogle Chatメッセージ

現在はモックデータを使用しています。実データを使用するには、Google Cloud認証情報の設定が必要です。

**Q: LLM統合は有効ですか？**

A: 環境変数 `USE_LLM=true` が設定され、Google Cloud認証情報が正しく設定されている場合、LLM統合が有効になります。無効な場合は、ルールベース分析にフォールバックします。

---

## トラブルシューティング

### よくある問題と解決方法

#### 1. バックエンドが起動しない

**症状:**
- `uvicorn` コマンドを実行してもエラーが発生する

**解決方法:**
1. Pythonのバージョンを確認（3.11以上が必要）
2. 仮想環境が有効になっているか確認
3. 依存関係が正しくインストールされているか確認
   ```bash
   pip install -r requirements_minimal.txt
   ```

#### 2. フロントエンドが起動しない

**症状:**
- `pnpm dev` コマンドを実行してもエラーが発生する

**解決方法:**
1. Node.jsのバージョンを確認（18以上が必要）
2. pnpmがインストールされているか確認
   ```bash
   npm install -g pnpm
   ```
3. 依存関係が正しくインストールされているか確認
   ```bash
   pnpm install
   ```

#### 3. APIに接続できない

**症状:**
- フロントエンドからAPIにリクエストを送信してもエラーが発生する

**解決方法:**
1. バックエンドが起動しているか確認（http://localhost:8000/docs）
2. フロントエンドの環境変数（`.env.local`）を確認
   ```
   NEXT_PUBLIC_API_URL=http://localhost:8000
   ```
3. CORSエラーの場合、`config.py` のCORS設定を確認

#### 4. データが表示されない

**症状:**
- 議事録やチャットが表示されない

**解決方法:**
1. ブラウザの開発者ツール（F12）でNetworkタブを確認
2. APIリクエストが成功しているか確認
3. レスポンスデータが正しいか確認

#### 5. 実行が完了しない

**症状:**
- AI自律実行が完了しない

**解決方法:**
1. バックエンドのログを確認
2. WebSocket接続が確立されているか確認
3. 実行状態を `/api/execution/{execution_id}` で確認

### ログの確認方法

#### バックエンドのログ

バックエンドのログは標準出力に出力されます。ターミナルで確認できます。

**ログの見方:**
- `INFO`: 通常の処理ログ
- `WARNING`: 警告（API接続失敗等）
- `ERROR`: エラー（例外発生等）

**リクエストIDで追跡:**
各リクエストには一意のIDが付与されます。エラーが発生した場合、`error_id` を記録しておくと、トラブルシューティングが容易になります。

#### フロントエンドのログ

ブラウザの開発者ツール（F12）のConsoleタブで確認できます。

### サポートへの連絡方法

問題が解決しない場合は、以下の情報を含めてサポートに連絡してください：

1. **エラーID**: エラーレスポンスに含まれる `error_id`
2. **エラーメッセージ**: 表示されたエラーメッセージ
3. **再現手順**: 問題が発生するまでの手順
4. **環境情報**: 
   - OS（Windows / macOS / Linux）
   - Pythonバージョン
   - Node.jsバージョン
5. **ログ**: バックエンドとフロントエンドのログ

---

## 参考資料

- [クイックスタートガイド](./QUICKSTART.md) - 初めての起動手順
- [APIドキュメント](./backend/API_DOCUMENTATION.md) - APIの詳細仕様
- [開発者ガイド](./DEVELOPER_GUIDE.md) - 開発者向けドキュメント
- [アーキテクチャドキュメント](./ARCHITECTURE.md) - システム全体の設計
