# ブラウザE2Eテスト計画（設計レベル）

## 目的

- デモで実際にユーザーが辿るフローをブラウザ上で自動検証できる状態を目指す。
- まずはシナリオとツール候補を整理し、将来的な自動化（Playwright/Cypressなど）の設計を固める。

## ツール候補

### 1. Playwright

- TypeScript/JavaScriptベースで、Next.jsとの相性が良い。
- マルチブラウザ（Chromium/Firefox/WebKit）対応。
- WebSocketやNetworkログの取得も比較的容易。

### 2. Cypress

- フロントエンドエンジニアに馴染みがある。
- UIテストの記述が直感的。
- ただし、WebSocketの低レベルな検証には少し工夫が必要。

### 暫定方針

- **第1段階**: 既存の手動テストシナリオを整理し、どの部分を自動化したいかを明文化する。
- **第2段階**: Playwright を優先候補とし、時間が取れたタイミングで `Dev/app/v0-helm-demo` 配下に E2E テスト環境を追加する。

## シナリオ案

### シナリオ1: Case1 フルフロー

1. `/demo/case1` にアクセスし、「Before（人だけの場合）」状態が表示されることを確認。
2. 「Helmがある場合を見る」ボタンをクリックし、データ取り込みステップへ進む。
3. スケルトンローディングが表示され、実データ（議事録・チャット）が表示されることを確認。
4. 分析ステップへ進み、構造的問題の分析結果カードがアニメーション付きで表示されることを確認。
5. Executive 承認フローを辿り、「承認」を選択。
6. 「AI実行を開始」ボタンをクリックし、`ai_executing` 状態へ遷移することを確認。
7. 実行中パネルで、WebSocket経由の進捗バーが 0→100% へと遷移していくことを確認。
8. 完了後に `results_received` 状態へ遷移し、生成ドキュメントの URL（view/edit）が表示されることを確認。

### シナリオ2: エラー発生時のUX

1. バックエンドを意図的に停止するか、API URL を誤った値に設定する。
2. デモフローを開始し、APIエラーが発生した際にトースト通知が表示されることを確認。
3. グローバルな真っ赤なエラーバナーなどではなく、ユーザーフレンドリーなメッセージになっていることを確認。

### シナリオ3: レスポンシブレイアウト

1. モバイル相当のビューポート（例: 375x667）で `/demo/case1` を開く。
2. 主要なカードやボタンが1カラムレイアウトで崩れずに表示されることを確認。
3. デスクトップ相当（例: 1920x1080）でも、グリッド/カードが意図通りのレイアウトで表示されることを確認。

## 今後の自動化イメージ（Playwright想定）

- テストディレクトリ例: `Dev/app/v0-helm-demo/tests/e2e/`
- 基本構成:
  - `case1-full-flow.spec.ts` … シナリオ1を自動化
  - `case1-error-ux.spec.ts` … シナリオ2を自動化
  - `responsive-layout.spec.ts` … シナリオ3を自動化
- CI には必須ではなく、「リリース前にローカル/専用ジョブで回すチェック」として位置付ける。

## まとめ

- 現時点では、バックエンド/APIレベルの E2E + WebSocket テストを pytest でカバー済み。
- ブラウザE2Eは「どのフローを自動化するか」「どのツールを使うか」を整理した段階。
- 実装フェーズでは Playwright を第一候補とし、Case1 のフルフローから段階的に自動化していく。

